class View{constructor(t,e,s){this.parent=e,this.id=t,this.$root=s,this.children=[],this.parent&&this.parent.children.push(this)}app(){return this.parent?this.parent.app():this}root(){return this.$root}show(t){this.root().style.display=t?"block":"none"}showChild(t){this.children.forEach(e=>e.show(e.id===t))}visitElementChildren(t,e){for(let s=0;s<t.childElementCount;++s)e(t.children[s])}onMessage(t,...e){this.children.forEach(s=>s.onMessage(t,e))}}class ModalView extends View{constructor(t,e,s){super(t,e,s),this.$dialog=this.root().querySelector(".mp_mt_ml_modal_dialog"),this.$loader=this.root().querySelector(".mp_mt_ml_modal_loader"),this.$input=this.root().querySelector("input#modal_input_text"),this.root().querySelector("button#modal_button_ok").addEventListener("click",t=>{this.root().style.display="none",this.modal_callback&&this.modal_callback(null,this.$input.value)}),this.root().querySelector("button#modal_button_cancel").addEventListener("click",t=>{this.root().style.display="none",this.modal_callback&&this.modal_callback(!0,this.$input.value)})}unload(){this.root().remove(),this.modal_callback=null}_show(t,e,s){this.$dialog.style.display="flex",this.$loader.style.display="none",this.$input.value="",this.root().style.display="flex",this.root().querySelector("#modal_title").textContent=t,"object"==typeof e?e.error&&"string"==typeof e.error?this.root().querySelector("#modal_message").textContent=e.error:this.root().querySelector("#modal_message").textContent=JSON.stringify(e):this.root().querySelector("#modal_message").textContent=e,this.modal_callback=s}alert(t,e,s){this._show(t,e,s),this.root().querySelector(".mp_mt_ml_modal_input").style.display="none",this.root().querySelector("button#modal_button_cancel").style.display="none"}input(t,e,s){this._show(t,e,s),this.root().querySelector(".mp_mt_ml_modal_input").style.display="flex",this.root().querySelector("button#modal_button_cancel").style.display="flex"}confirm(t,e,s){this._show(t,e,s),this.root().querySelector(".mp_mt_ml_modal_input").style.display="none",this.root().querySelector("button#modal_button_cancel").style.display="flex"}loader(t,e){t?(this.$loader.textContent=e||"processing..",this.root().style.display="flex",this.$dialog.style.display="none",this.$loader.style.display="flex"):this.root().style.display="none"}}Util={shuffle:function(t){for(var e,s,i=t.length;i;)s=Math.floor(Math.random()*i--),e=t[i],t[i]=t[s],t[s]=e;return t},isembd:function(){return top!==self}};class Alphabet{constructor(){this.data=[],this.populate()}static instance(){return Alphabet._instance||(Alphabet._instance=new Alphabet),Alphabet._instance}add(t,e,s,i,n,o){let r={l:String.fromCharCode(s),L:String.fromCharCode(i),c:String.fromCharCode(t),C:String.fromCharCode(e),cCode:t,CCode:e,lCode:s,LCode:i};return n&&(r.l+=String.fromCharCode(n)),o&&(r.L+=String.fromCharCode(o)),this.data.push(r),r}populate(){this.add(32,32,32,32).isSymbol=!0,this.add(63,63,63,63).isSymbol=!0,this.add(44,44,44,44).isSymbol=!0,this.add(46,46,46,46).isSymbol=!0,this.add(47,47,47,47).isSymbol=!0,this.add(95,95,95,95).isSymbol=!0,this.add(1072,1040,97,65),this.add(1073,1041,98,66),this.add(1094,1062,99,67),this.add(1095,1063,269,268),this.add(1115,1035,263,262),this.add(1076,1044,100,68),this.add(1119,1039,100,68,382,382),this.add(1106,1026,273,272),this.add(1077,1045,101,69),this.add(1092,1060,102,70),this.add(1075,1043,103,71),this.add(1093,1061,104,72),this.add(1080,1048,105,73),this.add(1112,1032,106,74),this.add(1082,1050,107,75),this.add(1083,1051,108,76),this.add(1113,1033,108,76,106,106),this.add(1084,1052,109,77),this.add(1085,1053,110,78),this.add(1114,1034,110,78,106,106),this.add(1086,1054,111,79),this.add(1087,1055,112,80),this.add(1088,1056,114,82),this.add(1089,1057,115,83),this.add(1096,1064,353,352),this.add(1090,1058,116,84),this.add(1091,1059,117,85),this.add(1074,1042,118,86),this.add(1079,1047,122,90),this.add(1078,1046,382,381)}find(t){return this.data.find(e=>e.cCode===t||e.CCode===t||e.lCode===t||e.LCode===t)}}class Sentence{constructor(t,e,s,i,n){this.id=t,this.en=e,this.cy=s,this.la=i,this.hint=n}parse(){let t=[],e=this.getCyrillic();for(let s=0;s<e.length;++s){let i=e.charCodeAt(s),n=Alphabet.instance().find(i);if(!n)throw"no char found for ccode "+i;t.push(n)}return t}normalize(t){return t=t.toLowerCase(),t=t.replace("?",""),t=t.replace(",",""),t=t.replace("/",""),t=t.replace("_",""),t=t.replace(".",""),t=t.replace(";",""),t=t.replace("!",""),t=t.replace("  "," "),t=t.trim()}getLatin(){if(this.la)return this.la;this.la="";for(let t=0;t<this.cy.length;++t){let e=this.cy.charCodeAt(t),s=Alphabet.instance().find(e);this.la+=s?s.l:this.cy.charAt(t)}return this.la}getCyrillic(){if(this.cy)return this.cy;this.cy="";for(var t=0;t<this.la.length;++t){var e=this.la.charCodeAt(t);let s=Alphabet.instance().find(e);this.cy+=s?s.l:this.la.charAt(t)}return this.cy}getEnglish(){return this.en}get(t){return"english"===t?this.en:"cyrillic"===t?this.getCyrillic():"latin"===t?this.getLatin():void 0}getCyrillicWords(){return this.normalize(this.getCyrillic()).split(" ")}getWords(t){return"english"===t?this.getEnglishWords():"latin"===t?this.getLatinWords():"cyrillic"===t?this.getCyrillicWords():void 0}getLatinWords(){return this.normalize(this.getLatin()).split(" ")}getEnglishWords(){for(var t=this.normalize(this.en).split(" "),e=0;e<t.length;++e)"i"===t[e]&&(t[e]="I");return t}}class Sentences{constructor(){this.data=[]}add(t,e,s,i,n){let o=new Sentence(t,e,s,i,n);this.data.push(o)}size(){return this.data.length}load(t,e){fetch(t).then(t=>{200===t.status?t.json().then(t=>{this.loadData(t),e()}):console.log("Looks like there was a problem. Status Code: "+t.status)}).catch(function(t){console.log("Fetch Error :-S",t)})}loadData(t){this.data=[],t.forEach(t=>{this.add(t.id,t.en,t.cy,t.la,t.hint)})}populate(){this.add("en_sb_bc_01_01","Stop","Стој"),this.add("en_sb_bc_01_08","Follow me","Пратите ме"),this.add("en_sb_bc_01_10","Wait here","Чекајте овде"),this.add("en_sb_bc_01_13","Come with me","Пођите са мном"),this.add("en_sb_bc_01_42","Go home","Идите кући"),this.add("en_sb_bc_01_43","Open","Отворите"),this.add("en_sb_bc_01_44","Close","Затворите"),this.add("en_sb_bc_01_46","Bring me","Донесите ми"),this.add("en_sb_bc_01_47","Distribute","Распоредите"),this.add("en_sb_bc_01_48","Fill","Испуните"),this.add("en_sb_bc_01_49","Lift","Подигните"),this.add("en_sb_bc_01_50","Pour into","Сипајте у"),this.add("en_sb_bc_01_51","Put","Ставите"),this.add("en_sb_bc_01_52","Take","Понесите"),this.add("en_sb_bc_01_53","Load","Утоварите"),this.add("en_sb_bc_01_54","Unload","Истоварите"),this.add("en_sb_bc_01_55","Help me","Помозите ми"),this.add("en_sb_bc_01_56","Show me","Покажите ми"),this.add("en_sb_bc_01_57","Tell me","Кажите ми"),this.add("en_sb_bc_02_01","Please","Молим Вас"),this.add("en_sb_bc_02_02","Thank you","Хвала"),this.add("en_sb_bc_02_03","Can someone assist us?","Да ли нам неко може помоћи?"),this.add("en_sb_bc_02_04","OK","У реду"),this.add("en_sb_bc_02_05","Excuse me. I'm sorry","Извините. Жао ми је"),this.add("en_sb_bc_02_06","Yes","Да"),this.add("en_sb_bc_02_07","No","Не"),this.add("en_sb_bc_02_08","Maybe","Можда"),this.add("en_sb_bc_02_09","Right","Тачно"),this.add("en_sb_bc_02_10","Wrong","Нетачно"),this.add("en_sb_bc_02_11","Here","Овде"),this.add("en_sb_bc_02_12","There","Тамо"),this.add("en_sb_bc_02_13","I want","Хоћу"),this.add("en_sb_bc_02_14","I do not want","Нећу"),this.add("en_sb_bc_02_15","Danger","Опасност"),this.add("en_sb_bc_02_21","OK, no problem","У реду, нема проблема"),this.add("en_sb_bc_02_22","Who?","Ко?"),this.add("en_sb_bc_02_23","What?","Шта?"),this.add("en_sb_bc_02_24","When?","Када?"),this.add("en_sb_bc_02_25","Where?","Где?"),this.add("en_sb_bc_02_26","Why?","Зашто?"),this.add("en_sb_bc_02_27","How?","Како?"),this.add("en_sb_bc_02_28","What happened?","Шта се догодило?"),this.add("en_sb_bc_02_29","Do you have _?","Да ли имате _?"),this.add("en_sb_bc_02_30","Do you need help?","Да ли Вам је потребна помоћ?"),this.add("en_sb_bc_02_31","I am","Ја сам"),this.add("en_sb_bc_02_32","You are","Ти си"),this.add("en_sb_bc_02_33","He is / she is","Он / Она је"),this.add("en_sb_bc_02_34","We are","Ми смо"),this.add("en_sb_bc_02_35","They are","Они су"),this.add("en_sb_bc_03_01","Welcome","Доброшли"),this.add("en_sb_bc_03_02","Hello","Здраво"),this.add("en_sb_bc_03_03","Good morning","Добро јутро"),this.add("en_sb_bc_03_04","Good night","Лаку ноћ"),this.add("en_sb_bc_03_05","Good bye","Довиђења"),this.add("en_sb_bc_03_06","How are you?","Како сте?"),this.add("en_sb_bc_03_07","I am fine, thanks, and you?","Хвала, добро сам, а Ви?"),this.add("en_sb_bc_03_08","I am pleased to meet you","Драго ми је што смо се упознали"),this.add("en_sb_bc_03_09","Thank you for your help","Хвала на помоћи"),this.add("en_sb_bc_03_10","My name is _","Зовем се _")}next(){return this.random()}random(){let t=Math.floor(Math.random()*this.data.length);return this.data[t]}}class Profiles{constructor(){this.profiles=[],this.init()}init(){localStorage.profiles||(this.add("default"),this.save()),this.load()}add(t){if(!t)return!1;t=t.replace(/[^a-z0-9]/gi,"");return console.log(t),!!t.length&&(!this.get(t)&&(this.profiles.push({name:t,unlocked:[],points:0}),this.save(),!0))}remove(t){let e=this.profiles.findIndex(e=>e.name===t);e>-1&&this.profiles.splice(e,1),this.save()}save(){localStorage.profiles=JSON.stringify(this.profiles)}load(){var t=localStorage.profiles;this.profiles=JSON.parse(t)}setCurrent(t){this.profile=this.profiles.find(e=>e.name===t)}getCurrent(){return this.profile}getNames(){return this.profiles.map(t=>t.name)}get(t){return this.profiles.find(e=>e.name===t)}markUnitCompleted(t){let e=this.getCurrent(),s=e.unlocked.find(e=>e.id===t);s||(s={id:t},e.unlocked.push(s)),s.time=Date.now(),this.save(),this.load()}}class MainView extends View{constructor(t,e,s){super(t,e,s),this.editor=new Editor("editor",this,this.root().querySelector(".editor")),this.units=new Units("units",this,this.root().querySelector(".units")),this.profiles=new ProfilesView("profiles",this,this.root().querySelector(".profiles"))}init(){this.showChild("profiles")}onMessage(t,...e){"enter_units"===t?(this.units.render(),this.showChild("units")):"unit_completed"===t&&this.onUnitCompleted(),super.onMessage(t,e)}loadUnit(t){this.app().modal.loader(!0,"loading unit.."),this.app().sentences.load("data/"+t+".json",e=>{this.app().modal.loader(!1),e?app.modal.alert("error","error loading the unit"):(this.editor.init(t,this.app().sentences.data),this.showChild("editor"))})}onUnitCompleted(t){this.units.render(),this.showChild("units")}}class Editor extends View{constructor(t,e,s){super(t,e,s),this.sentence=null,this.question=null,this.help=null,this.response_words=null,this.options_words=null,this.$question=this.root().querySelector(".question"),this.$answer=this.root().querySelector("#answer"),this.$options=this.root().querySelector("#options"),this.$progress=this.root().querySelector("#progress"),this.$points=this.root().querySelector("#points"),this.$total=this.root().querySelector("#total"),this.progress=0,this.points=0,this.help_used=!1,this.resolved=!1,this.$answer.addEventListener("click",t=>this.onClickAnswer(t)),this.$options.addEventListener("click",t=>this.onClickOptions(t)),this.btn_next=this.root().querySelector("button#next"),this.btn_next.addEventListener("click",t=>this.next()),this.root().querySelector("button#help").addEventListener("click",t=>this.onHelp()),this.root().querySelector("button#exit").addEventListener("click",t=>this.exit())}init(t,e){this.unitid=t,this.sentences=e,this.points=0,this.progress=0,this.updateProgress(),this.$total.textContent=this.sentences.length,this.sentences.forEach(t=>{t.visited=0}),this.next()}updateProgress(){this.$points.textContent=this.points,this.$progress.textContent=this.progress}exit(){this.parent.showChild("units")}next(){let t=Math.random()>.5?"serbian2english":"english2serbian",e=Math.random()>.5?"cyrillic":"latin",s=Math.floor(Math.random()*this.sentences.length),i=0,n=null;do{let t=s+i;t>=this.sentences.length&&(t-=this.sentences.length),this.sentences[t].visited||((n=this.sentences[t]).visited=1),i++}while(!n&&i<this.sentences.length);n?this.load(n,t,e):(this.app().profiles.markUnitCompleted(this.unitid),this.app().modal.alert("Unit Completed","Congratulations! You completed this unit!",()=>this.app().onMessage("unit_completed",this.unitid)))}load(t,e,s){function i(t){t.forEach(t=>{n[t]=!0})}if(this.sentence=t,"serbian2english"===e){if("cyrillic"===s)this.question=t.getCyrillic();else{if("latin"!==s)throw"unknown alphabet: "+s;this.question=t.getLatin()}this.answer=t.getEnglish()}else if("english2serbian"===e)if(this.question=t.getEnglish(),"cyrillic"===s)this.answer=t.getCyrillic();else{if("latin"!==s)throw"unknown alphabet:"+s;this.answer=t.getLatin()}"serbian2english"===e&&(s="english"),this.response_words=t.getWords(s),console.log("question: (mode: "+e+" alphabet: "+s+")"),console.log(this.question),console.log("answer:"),console.log(this.answer),console.log(this.response_words);let n={};i(this.response_words);let o=Math.max(4,2*this.response_words.length);for(;Object.keys(n).length<o;){i(app.sentences.random().getWords(s))}console.log(n);let r=this.root().querySelector("span#english2serbian"),l=this.root().querySelector("span#serbian2english");"english2serbian"===e?(r.style.display="block",l.style.display="none"):(r.style.display="none",l.style.display="block"),this.sentence.hint?this.$question.textContent=this.question+"("+this.sentence.hint+")":this.$question.textContent=this.question,this.btn_next.setAttribute("disabled","disabled"),this.$answer.textContent="",this.help=this.sentence.get(s),this.$options.textContent="";let h=Object.keys(n);Util.shuffle(h),h.forEach(t=>{let e=document.createElement("span");e.classList.add("word"),e.textContent=t,this.$options.appendChild(e)}),this.help_used=!1,this.resolved=!1}onClickAnswer(t){"word"===t.target.className&&(t.target.remove(),this.$options.appendChild(t.target),this.validate())}onClickOptions(t){"word"===t.target.className&&(t.target.remove(),this.$answer.appendChild(t.target),this.validate())}validate(){let t=!0,e=this.$answer.children;if(e.length!==this.response_words.length)t=!1;else for(let s=0;s<e.length;++s)if(e[s].textContent.toLowerCase()!==this.response_words[s].toLowerCase()){t=!1;break}return t&&(this.btn_next.removeAttribute("disabled"),this.resolved||(this.resolved=!0,this.progress++,this.points++,this.updateProgress())),t}onKeyboard(t){}onHelp(){this.resolved||(this.resolved=!0,this.progress++,this.updateProgress()),this.app().modal.alert("Help",this.help)}}class Units extends View{constructor(t,e,s){super(t,e,s),this.$units=this.root().querySelector("ul#units"),this.add("unit1","Unit 1","intro"),this.add("unit2","Unit 2","greetings"),this.add("unit3","Unit 3","languages"),this.add("unit4","Unit 4","restaurant"),this.add("unit5","Unit 5","restaurant"),this.add("unit6","Unit 6","shopping"),this.add("unit7","Unit 7","directions"),this.$units.addEventListener("click",t=>this.onUnit(t.target))}onUnit(t){let e=t.closest("li");if(!e)return;let s=e.getAttribute("id");this.parent.loadUnit(s)}render(){this.visitElementChildren(this.root(),t=>{t.classList.remove("completed")});this.app().profiles.getCurrent().unlocked.forEach(t=>{this.$units.querySelector("li#"+t.id).classList.add("completed")})}add(t,e,s){let i=`<li id="${t}" class="unit"> \n        <h2>${e}</h2>\n        <p>${s}</p>\n      </li>`;this.$units.insertAdjacentHTML("beforeend",i)}}class ProfilesView extends View{constructor(t,e,s){super(t,e,s),this.el_profiles=this.root().querySelector("ul"),this.el_profiles.addEventListener("click",t=>this.onProfile(t.target)),this.btn_add=this.root().querySelector("button#add"),this.btn_add.addEventListener("click",t=>this.onAdd()),this.btn_remove=this.root().querySelector("button#remove"),this.btn_remove.addEventListener("click",t=>this.onRemove()),this.btn_select=this.root().querySelector("button#select"),this.btn_select.addEventListener("click",t=>this.onSelect()),this.btn_add.removeAttribute("disabled"),this.btn_remove.setAttribute("disabled","disabled"),this.btn_select.setAttribute("disabled","disabled"),this.selected=null,this.init()}init(){this.render()}render(){let t="";this.app().profiles.getNames().forEach(e=>{t+=`<li id="${e}" class="profile">${e}</li>`}),this.el_profiles.innerHTML=t}onProfile(t){let e=t.getAttribute("id");e&&(this.selected=e,this.visitElementChildren(this.el_profiles,t=>{t.getAttribute("id")===e?t.classList.add("selected"):t.classList.remove("selected")}),this.btn_remove.removeAttribute("disabled"),this.btn_select.removeAttribute("disabled"))}onAdd(){this.app().modal.input("New Profile","Name:",(t,e)=>{t||this.app().profiles.add(e)&&this.app().modal.alert("Profile created!","important: profile is only stored in this device.",t=>this.render())})}onRemove(){this.app().modal.confirm("Delete Profile","are you sure? will lost all the progress",t=>{t||(this.app().profiles.remove(this.selected),this.selected=null,this.btn_select.setAttribute("disabled","disabled"),this.btn_remove.setAttribute("disabled","disabled"),this.render())})}onSelect(){this.app().profiles.setCurrent(this.selected),this.app().onMessage("enter_units")}}class Lingoapp extends View{constructor(){super("app",null,document),Util.isembd()||(this.alphabet=new Alphabet,this.sentences=new Sentences,this.profiles=new Profiles,this.main=new MainView("main",this,this.root().querySelector("main")),this.modal=new ModalView("modals",this,this.root().querySelector("div#modal_errors")))}init(){Util.isembd()||this.main.init()}onMessage(t,...e){Util.isembd()||(console.log("main app onMessage:"+t),super.onMessage(t,e))}onKeyboard(t){this.editor.onKeyboard(t)}}