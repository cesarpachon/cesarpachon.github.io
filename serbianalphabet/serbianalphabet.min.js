class View{constructor(t,e,s){this.parent=e,this.id=t,this.$root=s,this.children=[],this.parent&&this.parent.children.push(this)}app(){return this.parent?this.parent.app():this}root(){return this.$root}show(t){this.root().style.display=t?"block":"none"}showChild(t){this.children.forEach(e=>e.show(e.id===t))}visitElementChildren(t,e){for(let s=0;s<t.childElementCount;++s)e(t.children[s])}onMessage(t,...e){this.children.forEach(s=>s.onMessage(t,e))}}class ModalView extends View{constructor(t,e,s){super(t,e,s),this.$dialog=this.root().querySelector(".mp_mt_ml_modal_dialog"),this.$loader=this.root().querySelector(".mp_mt_ml_modal_loader"),this.$input=this.root().querySelector("input#modal_input_text"),this.root().querySelector("button#modal_button_ok").addEventListener("click",t=>{this.root().style.display="none",this.modal_callback&&this.modal_callback(null,this.$input.value)}),this.root().querySelector("button#modal_button_cancel").addEventListener("click",t=>{this.root().style.display="none",this.modal_callback&&this.modal_callback(!0,this.$input.value)})}unload(){this.root().remove(),this.modal_callback=null}_show(t,e,s){this.$dialog.style.display="flex",this.$loader.style.display="none",this.$input.value="",this.root().style.display="flex",this.root().querySelector("#modal_title").textContent=t,"object"==typeof e?e.error&&"string"==typeof e.error?this.root().querySelector("#modal_message").textContent=e.error:this.root().querySelector("#modal_message").textContent=JSON.stringify(e):this.root().querySelector("#modal_message").textContent=e,this.modal_callback=s}alert(t,e,s){this._show(t,e,s),this.root().querySelector(".mp_mt_ml_modal_input").style.display="none",this.root().querySelector("button#modal_button_cancel").style.display="none"}input(t,e,s){this._show(t,e,s),this.root().querySelector(".mp_mt_ml_modal_input").style.display="flex",this.root().querySelector("button#modal_button_cancel").style.display="flex"}confirm(t,e,s){this._show(t,e,s),this.root().querySelector(".mp_mt_ml_modal_input").style.display="none",this.root().querySelector("button#modal_button_cancel").style.display="flex"}loader(t,e){t?(this.$loader.textContent=e||"processing..",this.root().style.display="flex",this.$dialog.style.display="none",this.$loader.style.display="flex"):this.root().style.display="none"}}Util={shuffle:function(t){for(var e,s,i=t.length;i;)s=Math.floor(Math.random()*i--),e=t[i],t[i]=t[s],t[s]=e;return t},isembd:function(){return top!==self}};class Alphabet{constructor(){this.data=[],this.populate()}static instance(){return Alphabet._instance||(Alphabet._instance=new Alphabet),Alphabet._instance}add(t,e,s,i,a,l){let o={l:String.fromCharCode(s),L:String.fromCharCode(i),c:String.fromCharCode(t),C:String.fromCharCode(e),cCode:t,CCode:e,lCode:s,LCode:i};return a&&(o.l+=String.fromCharCode(a)),l&&(o.L+=String.fromCharCode(l)),this.data.push(o),o}populate(){this.add(32,32,32,32).isSymbol=!0,this.add(63,63,63,63).isSymbol=!0,this.add(44,44,44,44).isSymbol=!0,this.add(46,46,46,46).isSymbol=!0,this.add(47,47,47,47).isSymbol=!0,this.add(95,95,95,95).isSymbol=!0,this.add(1072,1040,97,65),this.add(1073,1041,98,66),this.add(1094,1062,99,67),this.add(1095,1063,269,268),this.add(1115,1035,263,262),this.add(1076,1044,100,68),this.add(1119,1039,100,68,382,382),this.add(1106,1026,273,272),this.add(1077,1045,101,69),this.add(1092,1060,102,70),this.add(1075,1043,103,71),this.add(1093,1061,104,72),this.add(1080,1048,105,73),this.add(1112,1032,106,74),this.add(1082,1050,107,75),this.add(1083,1051,108,76),this.add(1113,1033,108,76,106,106),this.add(1084,1052,109,77),this.add(1085,1053,110,78),this.add(1114,1034,110,78,106,106),this.add(1086,1054,111,79),this.add(1087,1055,112,80),this.add(1088,1056,114,82),this.add(1089,1057,115,83),this.add(1096,1064,353,352),this.add(1090,1058,116,84),this.add(1091,1059,117,85),this.add(1074,1042,118,86),this.add(1079,1047,122,90),this.add(1078,1046,382,381)}find(t){return this.data.find(e=>e.cCode===t||e.CCode===t||e.lCode===t||e.LCode===t)}}class Sentences{constructor(){this.data=[]}add(t,e,s,i,a){let l=new Sentence(t,e,s,i,a);this.data.push(l)}size(){return this.data.length}load(t,e){fetch(t).then(t=>{200===t.status?t.json().then(t=>{this.loadData(t),e()}):console.log("Looks like there was a problem. Status Code: "+t.status)}).catch(function(t){console.log("Fetch Error :-S",t)})}loadData(t){this.data=[],t.forEach(t=>{this.add(t.id,t.en,t.cy,t.la,t.hint)})}populate(){this.add("en_sb_bc_01_01","Stop","Стој"),this.add("en_sb_bc_01_08","Follow me","Пратите ме"),this.add("en_sb_bc_01_10","Wait here","Чекајте овде"),this.add("en_sb_bc_01_13","Come with me","Пођите са мном"),this.add("en_sb_bc_01_42","Go home","Идите кући"),this.add("en_sb_bc_01_43","Open","Отворите"),this.add("en_sb_bc_01_44","Close","Затворите"),this.add("en_sb_bc_01_46","Bring me","Донесите ми"),this.add("en_sb_bc_01_47","Distribute","Распоредите"),this.add("en_sb_bc_01_48","Fill","Испуните"),this.add("en_sb_bc_01_49","Lift","Подигните"),this.add("en_sb_bc_01_50","Pour into","Сипајте у"),this.add("en_sb_bc_01_51","Put","Ставите"),this.add("en_sb_bc_01_52","Take","Понесите"),this.add("en_sb_bc_01_53","Load","Утоварите"),this.add("en_sb_bc_01_54","Unload","Истоварите"),this.add("en_sb_bc_01_55","Help me","Помозите ми"),this.add("en_sb_bc_01_56","Show me","Покажите ми"),this.add("en_sb_bc_01_57","Tell me","Кажите ми"),this.add("en_sb_bc_02_01","Please","Молим Вас"),this.add("en_sb_bc_02_02","Thank you","Хвала"),this.add("en_sb_bc_02_03","Can someone assist us?","Да ли нам неко може помоћи?"),this.add("en_sb_bc_02_04","OK","У реду"),this.add("en_sb_bc_02_05","Excuse me. I'm sorry","Извините. Жао ми је"),this.add("en_sb_bc_02_06","Yes","Да"),this.add("en_sb_bc_02_07","No","Не"),this.add("en_sb_bc_02_08","Maybe","Можда"),this.add("en_sb_bc_02_09","Right","Тачно"),this.add("en_sb_bc_02_10","Wrong","Нетачно"),this.add("en_sb_bc_02_11","Here","Овде"),this.add("en_sb_bc_02_12","There","Тамо"),this.add("en_sb_bc_02_13","I want","Хоћу"),this.add("en_sb_bc_02_14","I do not want","Нећу"),this.add("en_sb_bc_02_15","Danger","Опасност"),this.add("en_sb_bc_02_21","OK, no problem","У реду, нема проблема"),this.add("en_sb_bc_02_22","Who?","Ко?"),this.add("en_sb_bc_02_23","What?","Шта?"),this.add("en_sb_bc_02_24","When?","Када?"),this.add("en_sb_bc_02_25","Where?","Где?"),this.add("en_sb_bc_02_26","Why?","Зашто?"),this.add("en_sb_bc_02_27","How?","Како?"),this.add("en_sb_bc_02_28","What happened?","Шта се догодило?"),this.add("en_sb_bc_02_29","Do you have _?","Да ли имате _?"),this.add("en_sb_bc_02_30","Do you need help?","Да ли Вам је потребна помоћ?"),this.add("en_sb_bc_02_31","I am","Ја сам"),this.add("en_sb_bc_02_32","You are","Ти си"),this.add("en_sb_bc_02_33","He is / she is","Он / Она је"),this.add("en_sb_bc_02_34","We are","Ми смо"),this.add("en_sb_bc_02_35","They are","Они су"),this.add("en_sb_bc_03_01","Welcome","Доброшли"),this.add("en_sb_bc_03_02","Hello","Здраво"),this.add("en_sb_bc_03_03","Good morning","Добро јутро"),this.add("en_sb_bc_03_04","Good night","Лаку ноћ"),this.add("en_sb_bc_03_05","Good bye","Довиђења"),this.add("en_sb_bc_03_06","How are you?","Како сте?"),this.add("en_sb_bc_03_07","I am fine, thanks, and you?","Хвала, добро сам, а Ви?"),this.add("en_sb_bc_03_08","I am pleased to meet you","Драго ми је што смо се упознали"),this.add("en_sb_bc_03_09","Thank you for your help","Хвала на помоћи"),this.add("en_sb_bc_03_10","My name is _","Зовем се _")}next(){return this.random()}random(){let t=Math.floor(Math.random()*this.data.length);return this.data[t]}}class Sentence{constructor(t,e,s,i,a){this.id=t,this.en=e,this.cy=s,this.la=i,this.hint=a}parse(){let t=[],e=this.getCyrillic();for(let s=0;s<e.length;++s){let i=e.charCodeAt(s),a=Alphabet.instance().find(i);if(!a)throw"no char found for ccode "+i;t.push(a)}return t}normalize(t){return t=t.toLowerCase(),t=t.replace("?",""),t=t.replace(",",""),t=t.replace("/",""),t=t.replace("_",""),t=t.replace(".",""),t=t.replace(";",""),t=t.replace("!",""),t=t.replace("  "," "),t=t.trim()}getLatin(){if(this.la)return this.la;this.la="";for(let t=0;t<this.cy.length;++t){let e=this.cy.charCodeAt(t),s=Alphabet.instance().find(e);this.la+=s?s.l:this.cy.charAt(t)}return this.la}getCyrillic(){if(this.cy)return this.cy;this.cy="";for(var t=0;t<this.la.length;++t){var e=this.la.charCodeAt(t);let s=Alphabet.instance().find(e);this.cy+=s?s.l:this.la.charAt(t)}return this.cy}getEnglish(){return this.en}get(t){return"english"===t?this.en:"cyrillic"===t?this.getCyrillic():"latin"===t?this.getLatin():void 0}getCyrillicWords(){return this.normalize(this.getCyrillic()).split(" ")}getWords(t){return"english"===t?this.getEnglishWords():"latin"===t?this.getLatinWords():"cyrillic"===t?this.getCyrillicWords():void 0}getLatinWords(){return this.normalize(this.getLatin()).split(" ")}getEnglishWords(){for(var t=this.normalize(this.en).split(" "),e=0;e<t.length;++e)"i"===t[e]&&(t[e]="I");return t}}class Keyboard{constructor(){this.root=document.querySelector("div.keyboard")}init(){app.alphabet.data.forEach(t=>{if(t.isSymbol)return;let e=document.createElement("div");e.classList.add("key"),e.setAttribute("id",t.c);let s=document.createElement("span");s.classList.add("latin"),s.textContent=t.l+t.L,e.appendChild(s);let i=document.createElement("span");i.classList.add("cyrillic"),i.textContent=t.c+t.C,e.appendChild(i),this.root.appendChild(e)}),this.root.addEventListener("click",t=>{this.onClick(t)})}show(t){let e=this.root.querySelectorAll(".cyrillic"),s=this.root.querySelectorAll(".latin");e.forEach(e=>{e.style.display="cyrillic"===t?"block":"none"}),s.forEach(e=>{e.style.display="latin"===t?"block":"none"})}onClick(t){console.log(t.target);let e;if(t.target.classList.contains("key"))e=t.target.getAttribute("id");else{if(!t.target.parentNode.classList.contains("key"))return!1;e=t.target.parentNode.getAttribute("id")}app.onKeyboard(e)}}class Editor{constructor(){this.root=document.querySelector(".editor"),this.elSource=this.root.querySelector("#source"),this.elTarget=this.root.querySelector("#target");let t=this;this.elSource.addEventListener("click",function(e){t.onClick(e)}),this.elTarget.addEventListener("click",function(e){t.onClick(e)})}load(t,e){for(var s;s=this.elSource.lastChild;)this.elSource.removeChild(s);for(;s=this.elTarget.lastChild;)this.elTarget.removeChild(s);this.mode=e,this.sentence=t;let i=this.root.querySelector("span#cyrillic2latin"),a=this.root.querySelector("span#latin2cyrillic");"cyrillic2latin"===e?(i.style.display="block",a.style.display="none"):(i.style.display="none",a.style.display="block");this.root.querySelector(".english").textContent=t.en;this.root.querySelector("#listen").setAttribute("src",`sb_bc_audio/${t.id}.mp3`),this.characters=t.parse();let l=0;this.characters.forEach(t=>{let s=document.createElement("div");s.classList.add("key"),s.setAttribute("id",l);let i=document.createElement("span");"cyrillic2latin"===e?(i.classList.add("cyrillic"),i.classList.remove("latin"),i.textContent=t.c):(i.classList.add("latin"),i.classList.remove("cyrillic"),i.textContent=t.l),s.appendChild(i),this.elSource.appendChild(s),(s=document.createElement("div")).classList.add("key"),s.setAttribute("id",l);let a=document.createElement("span");"cyrillic2latin"===e?(a.classList.add("latin"),a.classList.remove("cyrillic"),a.textContent=t.l):(a.classList.add("cyrillic"),a.classList.remove("latin"),a.textContent=t.c),a.style.display=t.isSymbol?"block":"none",s.appendChild(a),this.elTarget.appendChild(s),l++}),this.cursor=0,this.updateCursor(0)}onClick(t){let e;if(t.target.classList.contains("key"))e=+t.target.getAttribute("id");else{if(!t.target.parentElement.classList.contains("key"))return;e=+t.target.parentElement.getAttribute("id")}console.log(e),this.updateCursor(e)}updateCursor(t){let e=this.elSource.children[this.cursor];e.classList.remove("selected"),(e=this.elTarget.children[this.cursor]).classList.remove("selected"),this.cursor=t,(e=this.elSource.children[this.cursor]).classList.add("selected"),(e=this.elTarget.children[this.cursor]).classList.add("selected")}onKeyboard(t){let e=this.elTarget.children[this.cursor],s=this.characters[this.cursor];t===s.c||t===s.C||t===s.L||t===s.l?(e.firstElementChild.style.display="block",this.moveCursor()):"cyrillic2latin"===this.mode?app.modal.alert("Wrong character!","Expected: "+s.l+" or "+s.L):app.modal.alert("Wrong character!","Expected: "+s.c+" or "+s.C)}moveCursor(){if(this.cursor+1>=this.characters.length)return;let t=this.cursor+1;for(;t<this.characters.length-1&&this.characters[t].isSymbol;)t++;this.updateCursor(t)}}class App{constructor(){if(Util.isembd())return;this.alphabet=new Alphabet,this.sentences=new Sentences,this.sentences.populate(),this.editor=new Editor,this.keyboard=new Keyboard,this.modal=new ModalView("modal",null,document.querySelector("div#modal_errors"));document.querySelector("button#next").addEventListener("click",t=>this.next())}init(){Util.isembd()||(this.keyboard.init(),this.keyboard.show("latin"),this.next())}next(){if(Util.isembd())return;let t=Math.random()>.5?"cyrillic2latin":"latin2cyrillic";this.editor.load(this.sentences.next(),t),"cyrillic2latin"===t?this.keyboard.show("latin"):this.keyboard.show("cyrillic")}onKeyboard(t){this.editor.onKeyboard(t)}}